<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="SecureAndroid : A small library for encrypting and storing data securely on Android devices.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>SecureAndroid</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/dsahm/secureandroid">View on GitHub</a>

          <h1 id="project_title">SecureAndroid</h1>
          <h2 id="project_tagline">A small library for encrypting and storing data securely on Android devices.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/dsahm/secureandroid/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/dsahm/secureandroid/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a id="welcome-to-secureandroid" class="anchor" href="#welcome-to-secureandroid" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to SecureAndroid</h3>

<p>SecureAndroid is a small library that will help you to easily encrypt, decrypt and store data securely on Android devices.
The library was designed with ease-of-use in mind. You do not have to worry about implementation details of cryptographic algorithms but simply use the provided API. 
SecureAndroid uses AES encryption in CBC mode with padding according to PKCS5. For data integrity HMacSHA256 or HMacSHA1 (according to the availability on the device) is used. For key derivation from passwords the PBKDF2WithHmacSHA256/1 (according to the availability on the device) is employed. 
SecureAndroid abstracts cryptographic implementation details and i/o-operations away so that you can concentrate on your app logic. </p>

<h3>
<a id="how-to-add-secureandroid-to-a-project" class="anchor" href="#how-to-add-secureandroid-to-a-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to add SecureAndroid to a project</h3>

<p>To use SecureAndroid, simply download the zip or tar.gz file and extract it. In your Android Studio project move to the java folder of your module:</p>

<p><img src="https://github.com/dsahm/secureandroid/blob/gh-pages/images/SecureAndroidUseStep1.png" alt=""></p>

<p>Create a new package:</p>

<p><img src="https://github.com/dsahm/secureandroid/blob/gh-pages/images/SecureAndroidUseStep2.png" alt=""></p>

<p>Choose your module as the destination:</p>

<p><img src="https://github.com/dsahm/secureandroid/blob/gh-pages/images/SecureAndroidUseStep3.png" alt=""></p>

<p>Name the package <em>my.secureandroid</em>:</p>

<p><img src="https://github.com/dsahm/secureandroid/blob/gh-pages/images/SecureAndroidUseStep4.png" alt=""></p>

<p>Go to where you extracted the zip or tar.gz file and drag or copy/paste the java classes into the created package folder:</p>

<p><img src="https://github.com/dsahm/secureandroid/blob/gh-pages/images/SecureAndroidUseStep5.png" alt=""></p>

<p>Simply click ok:</p>

<p><img src="https://github.com/dsahm/secureandroid/blob/gh-pages/images/SecureAndroidUseStep6.png" alt=""></p>

<p>That's it! After importing</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">import</span> <span class="pl-smi">my.secureandroid.SecureAndroid</span>;</pre></div>

<p>you can initialize a SecureAndroid object in your activity like this:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">try</span> {
    <span class="pl-smi">SecureAndroid</span> sc <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">SecureAndroid</span>(<span class="pl-smi">MyActivity</span><span class="pl-k">.</span><span class="pl-v">this</span>, <span class="pl-c1">5000</span>);
} <span class="pl-k">catch</span> (<span class="pl-smi">Exception</span> e) {
    <span class="pl-c">// Try it out to see the specific exceptions..and do smth</span>
}</pre></div>

<p>You must pass a Context and the minimum iterations for the PBKDF to the constructor. For more information on the iteration count, visit <a href="https://www.owasp.org/index.php/Password_Storage_Cheat_Sheet">OWASP</a>.
SecureAndroid tunes the iterations automatically so that users will have to wait for about 500ms when encrypting or decrypting data. So you need to only think about the minimum iteration count if there really is a minimum that is important to you. Otherwise, simply pass 0. 
If you set a high minimum count that negatively affects your performance, you could - as far as that is possible in the data-flow of your app - use AsyncTasks or libraries like RxJava (highly recommended!) to perform encryption and decryption in the background. Another option to achieve better performance is to switch the integrity check of the data off. More on that later.</p>

<h3>
<a id="the-api" class="anchor" href="#the-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>The API</h3>

<p>The SecureAndroid class is the only class you will have to use. If you want you can take a look into the other classes and build your own little library out of these...but for now let's simply focus on using the public methods of the SecureAndroid class. To get an overview, you can take a look at the <a href="https://dl.dropboxusercontent.com/u/7603573/site/index.html">javadocs</a>. If you want to learn about the public API you should look at the documentation of the class <em>SecureAndroid</em>.</p>

<h3>
<a id="encryptdecrypt" class="anchor" href="#encryptdecrypt" aria-hidden="true"><span class="octicon octicon-link"></span></a>encrypt/decrypt</h3>

<p>Lets start with simply encrypting and decrypting some data, for example a string:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// Encrypt a string</span>
<span class="pl-k">byte</span>[] ciphertext <span class="pl-k">=</span> sc<span class="pl-k">.</span>encrypt(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, <span class="pl-s"><span class="pl-pds">"</span>mystring<span class="pl-pds">"</span></span><span class="pl-k">.</span>getBytes(<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>));
<span class="pl-c">// Decrypt the string</span>
<span class="pl-smi">String</span> mystring <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">String</span>(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, sc<span class="pl-k">.</span>decrypt(ciphertext), <span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>));</pre></div>

<p>All key handling and cryptographic operations are done transparently. When the encrypt and decrypt methods are called, SecureAndroid uses an auto-generated password that is device specific. That password is not stored on the device but can be read from it when someone else gets his hands on it. </p>

<p>Note: To switch off integrity-checking of your data, you can pass the flag</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>NO_INTEGRITY</span></pre></div>

<p>instead of</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span></pre></div>

<p>This will give you a ~30% performance-boost.</p>

<h3>
<a id="encryptwithpassworddecryptwithpassword" class="anchor" href="#encryptwithpassworddecryptwithpassword" aria-hidden="true"><span class="octicon octicon-link"></span></a>encryptWithPassword/decryptWithPassword</h3>

<p>So, while the auto-password option is good if you simply want to add a layer of security to your app, if the data to be encrypted is very sensitive, you should provide a password yourself. For example, you could ask the user for a passphrase and then use SecureAndroid like this:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// Encrypt a string with a given password</span>
<span class="pl-k">byte</span>[] ciphertext <span class="pl-k">=</span> sc<span class="pl-k">.</span>encryptWithPassword(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, <span class="pl-s"><span class="pl-pds">"</span>mystring<span class="pl-pds">"</span></span><span class="pl-k">.</span>getBytes(<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>mypassword<span class="pl-pds">"</span></span><span class="pl-k">.</span>toCharArray());
<span class="pl-c">// Decrypt the string with the password</span>
<span class="pl-smi">String</span> mystring <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">String</span>(sc<span class="pl-k">.</span>decryptWithPassword(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, ciphertext, <span class="pl-s"><span class="pl-pds">"</span>mypassword<span class="pl-pds">"</span></span><span class="pl-k">.</span>toCharArray()), <span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>);</pre></div>

<h3>
<a id="important-note-on-password-handling" class="anchor" href="#important-note-on-password-handling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Important note on password handling</h3>

<p>You can only have one password context-wide. The password is set when the first encryption-operation is performed. Nevertheless, you can change the password after first encrypting something. The methods to do that are described later on. </p>

<h3>
<a id="encryptandstoreretrieve" class="anchor" href="#encryptandstoreretrieve" aria-hidden="true"><span class="octicon octicon-link"></span></a>encryptAndStore/retrieve</h3>

<p>SecureAndroid does not only provide you with methods to simply encrypt and decrypt binary data that you can then handle yourself but also with methods to encrypt and directly store data. This abstracts i/o-operations away. You simply have to remember the alias under which you want the data to be stored. Again, with the encryptAndStore/retrieve methods an auto-generated password is used. You can choose whether you want to store the data in the SharedPreferences or in a file with the MODE flag-option: SecureAndroid.Mode.FILE or SecureAndroid.Mode.SHARED_PREFERENCES. </p>

<p>Note: If you want to store larger binary data the use of FILE should be preferred.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// Encrypt a string and store it under the given alias in FILE mode</span>
sc<span class="pl-k">.</span>encryptAndStore(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, <span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Mode</span><span class="pl-c1"><span class="pl-k">.</span>FILE</span>, <span class="pl-s"><span class="pl-pds">"</span>mystring<span class="pl-pds">"</span></span><span class="pl-k">.</span>getBytes(<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>data_alias<span class="pl-pds">"</span></span>);
<span class="pl-c">// Retrieve the string</span>
<span class="pl-smi">String</span> mystring <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">String</span>(sc<span class="pl-k">.</span>retrieve(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, <span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Mode</span><span class="pl-c1"><span class="pl-k">.</span>FILE</span>, <span class="pl-s"><span class="pl-pds">"</span>data_alias<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>);</pre></div>

<h3>
<a id="encryptandstorewithpasswordretrievewithpassword" class="anchor" href="#encryptandstorewithpasswordretrievewithpassword" aria-hidden="true"><span class="octicon octicon-link"></span></a>encryptAndStoreWithPassword/retrieveWithPassword</h3>

<p>The encryptAndStoreWithPassword and retrieveWithPassword methods provide the same functionality as the above methods only that you can provide your own password. See # encryptWithPassword.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// Encrypt a string with password and store it under the given alias in FILE mode</span>
sc<span class="pl-k">.</span>encryptAndStoreWithPassword(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, <span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Mode</span><span class="pl-c1"><span class="pl-k">.</span>FILE</span>, <span class="pl-s"><span class="pl-pds">"</span>mystring<span class="pl-pds">"</span></span><span class="pl-k">.</span>getBytes(<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>data_alias<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mypassword<span class="pl-pds">"</span></span><span class="pl-k">.</span>toCharArray());
<span class="pl-c">// Retrieve</span>
<span class="pl-smi">String</span> mystring <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">String</span>(sc<span class="pl-k">.</span>retrieveWithPassword(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>INTEGRITY</span>, <span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Mode</span><span class="pl-c1"><span class="pl-k">.</span>FILE</span>, <span class="pl-s"><span class="pl-pds">"</span>data_alias<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mypassword<span class="pl-pds">"</span></span><span class="pl-k">.</span>toCharArray()), <span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>);</pre></div>

<h3>
<a id="changepasswordchangefromautopasswordchangetoautopassword" class="anchor" href="#changepasswordchangefromautopasswordchangetoautopassword" aria-hidden="true"><span class="octicon octicon-link"></span></a>changePassword/changeFromAutoPassword/changeToAutoPassword</h3>

<p>If you want to change the password (see above), you can use one of these methods. The changePassword method must be invoked if you have manually set a password before. If you used to auto-generated password, you can set a manual password with changeFromAutoPassword. Accordingly, you can revert back from using a manual password to the auto-generate-option by calling changeToAutoPassword. Lets take a look at an example:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// Encrypt something with the auto generated password</span>
<span class="pl-k">byte</span>[] cipher <span class="pl-k">=</span> secureAndroid<span class="pl-k">.</span>encrypt(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>NO_INTEGRITY</span>, mystring<span class="pl-k">.</span>getBytes(<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>));
<span class="pl-c">// Change password</span>
secureAndroid<span class="pl-k">.</span>changeFromAutoPassword(<span class="pl-s"><span class="pl-pds">"</span>my password<span class="pl-pds">"</span></span><span class="pl-k">.</span>toCharArray());
<span class="pl-c">// Decrypt your string</span>
<span class="pl-k">byte</span>[] plain <span class="pl-k">=</span> secureAndroid<span class="pl-k">.</span>decryptWithPassword(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Integrity</span><span class="pl-c1"><span class="pl-k">.</span>NO_INTEGRITY</span>, cipher, <span class="pl-s"><span class="pl-pds">"</span>my password<span class="pl-pds">"</span></span><span class="pl-k">.</span>toCharArray());
<span class="pl-c">// The same goes for reverting back to the auto password ...</span>
<span class="pl-c">// ...</span></pre></div>

<h3>
<a id="wipekey" class="anchor" href="#wipekey" aria-hidden="true"><span class="octicon octicon-link"></span></a>wipeKey</h3>

<p>In case you want to make all data that you have encrypted using SecureAndroid inaccessible and thus destroy it, you can simply wipe the key that was used to perform the cryptographic operations. That destroys the data since that key was generated completely (pseudo)-random. </p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// Wipe key and thus wipe data</span>
sc<span class="pl-k">.</span>wipeKey();</pre></div>

<h3>
<a id="deletedata" class="anchor" href="#deletedata" aria-hidden="true"><span class="octicon octicon-link"></span></a>deleteData</h3>

<p>If you want to delete a specific file or a something stored in the SharedPreferences you can do that by calling:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// Delete specific data</span>
sc<span class="pl-k">.</span>deleteData(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Mode</span><span class="pl-c1"><span class="pl-k">.</span>FILE</span>, <span class="pl-s"><span class="pl-pds">"</span>data_alias<span class="pl-pds">"</span></span>);
sc<span class="pl-k">.</span>deleteData(<span class="pl-smi">SecureAndroid</span><span class="pl-k">.</span><span class="pl-smi">Mode</span><span class="pl-c1"><span class="pl-k">.</span>SHARED_PREFERENCES</span>, <span class="pl-s"><span class="pl-pds">"</span>another_data_alias<span class="pl-pds">"</span></span>);
</pre></div>

<h3>
<a id="exceptions" class="anchor" href="#exceptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exceptions</h3>

<p>Note that SecureAndroid will throw some useful exceptions if something went wrong, for example if the wrong password was provided or you want to retrieve data that does not exist. See the javadocs for details.</p>

<h3>
<a id="how-does-it-work-under-the-hood" class="anchor" href="#how-does-it-work-under-the-hood" aria-hidden="true"><span class="octicon octicon-link"></span></a>How does it work under the hood?</h3>

<p>SecureAndroid takes an intermediate-key approach. All data is encrypted with AES-128 in CBC-Mode and Padding according to PKCS5. The integrity is checked with HmacSHA256/HmacSHA1, according to the availability on the device. The AES- and MAC-Keys used for enc- and decryption are themselves encrypted with an AES- and MAC-Masterkey and then stored on the device in encrypted form. The Masterkeys themselves are never stored on the device but are derived by PBKDFHmacSHA256/SHA1 on enc- or decryption.</p>

<h3>
<a id="what-password-is-used-for-deriving-the-master-keys" class="anchor" href="#what-password-is-used-for-deriving-the-master-keys" aria-hidden="true"><span class="octicon octicon-link"></span></a>What password is used for deriving the master-keys?</h3>

<p>If you simply use the encrypt and decrypt-methods an automatic password is generated and then fed into the PBKDF2. That password is a hash of device information and therefore bound to a device. <em>That means you cannot decrypt data on another device than the data was encrypted with</em>. </p>

<p>If you provide a password yourself or ask the user to provide one, that passphrase then is used to derive the keys. The intermediate keys are generated on the <em>first encryption operation</em>. In all subsequent encryption- or decryption processes these intermediate keys are used. 
<em>Note</em>: If you use SecureAndroid in an app, this means that the key-material will be deleted on app-deletion because it is stored in the apps SharedPreferences. If data should survive an app-uninstallation, you must provide that mechanism.</p>

<h3>
<a id="where-is-data-stored" class="anchor" href="#where-is-data-stored" aria-hidden="true"><span class="octicon octicon-link"></span></a>Where is data stored?</h3>

<p>All key material is stored in the SharedPreferences of the app that you are using SecureAndroid with. The encrypted data is stored either in the SharedPreferences or in a file, according the MODE flag (see Javadocs or explanation above).</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">SecureAndroid maintained by <a href="https://github.com/dsahm">dsahm</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
